---
title: "Bio 351 Lab Week 4: Wild fly data analysis; KEY"
output: html_notebook
---

Welcome to your second R lab. Today we'll practice some data manipulation, basic statistics, and plotting skills to look at our fly collections.

First we'll load the packages we need for data analysis and plotting
```{r, message=F}
library(data.table)
library(ggplot2)
```


Now look back at your code from week 1 to remind yourself of the command to load data from a csv file. The Save your new data table as an object named `data`. I know it is annoying to flip back and forth, but you will actually remember this better if you are forced to find and apply the information yourself rather than just blindly running code that I prepare for you!

```{r}
data<-fread("~/Box/BIO351_FALL2021/Lab/Week 4/dummydata.csv") #delete for student version
```

# Part 1: Analyze your group's data

First we'll pull out just the data for your group to do a preliminary analysis. Complete the code below to create a new object that just has the rows containing your data and name it "mydata". (Hint, you'll need to use an "==" symbol)

```{r}
mydata<-data[Group==1] ## delete for student version
```


Now use R to create a new column called "total" that has the total number of flies you collected and identified (hint, in the week 1 lab we created a column called "nObs" in a similar way)

```{r}
mydata[, total:=Zind+Dmel+Dhyd+Dsuz+otherD] # delete for student version
```

Next, let's test if your overall sampling was different between the netting and aspirating using a chi-square test. To conduct this test, we need to first isolate only the cells of our data table that have our count data in it. To pull out columns of a data table, we use the format:
`tablename[,c(names of columns you want to isolate)]`
For example:
`mydata[,c(Location, Method)]` would produce a table containing just those two columns

Use this approach to conduct a chi-square test on the columns containing your fly count data of each species (but not the total)

```{r}
chisq.test(mydata[,c(Zind, Dmel, Dhyd, Dsuz, otherD)])#remove for student version
```

***Question*** Interpret the results of your Chi-Square test. What was the null hypothesis and what does the test result tell us? What is your interpretation? Please answer in full sentences and leave the "*Answer Here*" present so that I can easily find your answer. 

***Answer here***

Now let's visualize that test by creating a bar graph showing the number of flies falling in each category for each collection method in your data.  

First we need to re-arrange the data into a "long" format, so that there is only one column that contains numbers that we care about. We'll use the "melt" function like we did in week 1.

```{r}
mydata.melt<-melt(mydata, idvars=c("Group", "Location", "Method", "total"),measure.vars=c("Zind", "Dmel", "Dhyd", "Dsuz", "otherD"))

```

**Question** Describe the new `mydata.melt` data table. What is different about it from `mydata`? 

**Answer Here** 

**Question** Based on your answer above, explain what the "idvars" and "measure.vars" arguments of the melt function are doing. 

**Answer Here** 

Let's rename the two new columns with the `set.names()` function. The usage of this function is `setnames(data_table_name, "old column name", "new column name")`. The column names, both old and new, need to be in quotation marks.

```{r}
 # example: this renames variable to species
setnames(mydata.melt, "variable", "species")

##now rename value to count

setnames(mydata.melt, "value", "count")#TYPE NEW CODE HERE

```

Now use the commented out lines below to complete the code for the graph. Remember that we are trying to compare the counts of flies that were netted or aspirated for each species in a bar graph.

```{r}
ggplot(mydata.melt)+ #this line just tells R that we are making a plot using data in mydata.melt
  geom_bar(aes(x=species, #what do you want on the x axis
               y=count, #what do you want on the y axis
               fill=Method), #what variable do you want to compare for each individual species?
           position="dodge", stat="identity") #this code is just giving some information about how we want to arrange the plot. "dodge" tells it to make side-by-side bars for each category, and "identity" tells it to plot the total number rather than the number of times the data occurs
  
```


***Question*** Write an appropriate figure legend for this figure

***Answer here ***

***Question*** Why might it be more appropriate to plot proportion data rather than count data?
 
 ***Answer here***


Let's remake the plot showing proportions instead. You can actually just do this calculation with the plot, by adding a division sign to the y argument (divide by the total number of individuals)

Copy your code from the last plot here and edit it to plot the proportion instead.

```{r}
#Delete entire box for student version
ggplot(mydata.melt)+ #this line just tells R that we are making a plot using data in mydata.melt
  geom_bar(aes(x=species, #what do you want on the x axis
               y=count/total, #what do you want on the y axis
               fill=Method), #what variable do you want to compare for each individual species?
           position="dodge", stat="identity") #this code is just giving some information about how we want to arrange the plot. "dodge" tells it to make side-by-side bars for each category, and "identity" tells it to plot the total number rather than the number of times the data occurs
  
```

Now let's test whether, as class, we found differences in the proportion of Zaprionus alculate a new colun that has the percentage of Zaprionus. to do this test, we'll use a paired T test, because each of our samples comes as a pair of data from one group (the percentage Zaprionus in the net, and the percentage zaprionus in the aspirator)


